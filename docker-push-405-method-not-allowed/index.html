<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Docker Push 出現 405 Method Not Allowed 錯誤？！ - Yowko&#39;s Notes</title><meta name=google-site-verification content=DvajWUA2XrtSgjsnGxXQKihwijBDiTFw9g7cxFY-Ivk><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content="Yowko Tsai"><meta name=description content="Docker Push 出現 405 Method Not Allowed 錯誤？ 之前筆記 解決 Docker build pip install fail 提到在練習 Kubernetes 過程中執行 docker build 指令時會出現 pip install fail 的 error，問題發生原因是 docker 的 DNS 解析不正確造成的，"><meta name=keywords content=yowko,.net,blog><meta name=generator content="Hugo 0.56.3"><meta name=msvalidate.01 content=FA1ADBDB8F0BBBD0F7F4E65CDEBF7898><link rel=canonical href=https://blog.yowko.com/docker-push-405-method-not-allowed/><link rel=apple-touch-icon sizes=180x180 href=https://blog.yowko.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yowko.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.yowko.com/favicon-16x16.png><link rel=manifest href=https://blog.yowko.com/manifest.json><link rel=mask-icon href=https://blog.yowko.com/safari-pinned-tab.svg color=#5bbad5><link href="https://blog.yowko.com/dist/even.min.css?v=3.2.0" rel=stylesheet><link href=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><meta property=og:title content="Docker Push 出現 405 Method Not Allowed 錯誤？！"><meta property=og:description content="Docker Push 出現 405 Method Not Allowed 錯誤？ 之前筆記 解決 Docker build pip install fail 提到在練習 Kubernetes 過程中執行 docker build 指令時會出現 pip install fail 的 error，問題發生原因是 docker 的 DNS 解析不正確造成的，"><meta property=og:type content=article><meta property=og:url content=https://blog.yowko.com/docker-push-405-method-not-allowed/><meta property=article:published_time content=2018-06-16T19:39:00+08:00><meta property=article:modified_time content=2021-11-03T19:39:54+08:00><meta itemprop=name content="Docker Push 出現 405 Method Not Allowed 錯誤？！"><meta itemprop=description content="Docker Push 出現 405 Method Not Allowed 錯誤？ 之前筆記 解決 Docker build pip install fail 提到在練習 Kubernetes 過程中執行 docker build 指令時會出現 pip install fail 的 error，問題發生原因是 docker 的 DNS 解析不正確造成的，"><meta itemprop=datePublished content=2018-06-16T19:39:00&#43;08:00><meta itemprop=dateModified content=2021-11-03T19:39:54&#43;08:00><meta itemprop=wordCount content=721><meta itemprop=keywords content=Docker,Linux,><meta name=twitter:card content=summary><meta name=twitter:title content="Docker Push 出現 405 Method Not Allowed 錯誤？！"><meta name=twitter:description content="Docker Push 出現 405 Method Not Allowed 錯誤？ 之前筆記 解決 Docker build pip install fail 提到在練習 Kubernetes 過程中執行 docker build 指令時會出現 pip install fail 的 error，問題發生原因是 docker 的 DNS 解析不正確造成的，"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><link href=https://blog.yowko.com/opensearch.xml rel=search title="Content search" type=application/opensearchdescription+xml></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=https://blog.yowko.com/><li class=mobile-menu-item>首頁</li></a><a href=https://blog.yowko.com/post/><li class=mobile-menu-item>歷史筆記</li></a><a href=https://blog.yowko.com/tags/><li class=mobile-menu-item>內容標籤</li></a><a href=https://blog.yowko.com/search><li class=mobile-menu-item>站內搜尋</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header style=height:118px;padding-bottom:0><div class=logo-wrapper><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div style=padding-bottom:60px></div></nav><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/>首頁</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/post/>歷史筆記</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/tags/>內容標籤</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/search>站內搜尋</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><hr style="border-top:1px solid #e6e6e6;border-bottom:0;padding:0"><div id=content class=content><article class=post><header class=post-header><div class=post-meta><span class=post-time>2018-06-16</span>
<span class=more-meta>約 721 字</span>
<span class=more-meta>預計閱讀 2 分鐘</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目錄</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#docker-push-出現-405-method-not-allowed-錯誤>Docker Push 出現 405 Method Not Allowed 錯誤？</a></li><li><a href=#環境說明>環境說明</a></li><li><a href=#錯誤訊息>錯誤訊息</a></li><li><a href=#問題發生原因>問題發生原因</a></li><li><a href=#解決方式>解決方式</a></li><li><a href=#心得>心得</a></li><li><a href=#參考資訊>參考資訊</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=docker-push-出現-405-method-not-allowed-錯誤>Docker Push 出現 405 Method Not Allowed 錯誤？</h2><p>之前筆記 <a href=https://blog.yowko.com/docker-build-pip-install-fail>解決 Docker build pip install fail</a> 提到在練習 Kubernetes 過程中執行 docker build 指令時會出現 pip install fail 的 error，問題發生原因是 docker 的 DNS 解析不正確造成的，解決方式是設定 Docker 的 DNS。</p><p>完成 docker build 產生的 image 只會存在執行指令的機器上，除非手動打包 image 至其他 Kubernetes Node 上，否則在執行 Kubernetes 部署時會出現找不到 image 而出現部署失敗的錯誤訊息，但 Kubernetes Node 可以動態增減，手動複製並沒有真正解決問題，透過將 image push 至 registry 才可以一勞永逸，只是想不到一個 <code>docker push</code> 也讓我卡關了XD 就來看看問題發生原因及解決方式吧</p><h2 id=環境說明>環境說明</h2><ol><li><p>linux 資料</p><blockquote><p><code>hostnamectl</code></p></blockquote><pre><code class=language-log>Static hostname: k8s06141
Icon name: computer-vm
Chassis: vm
Machine ID: a34d496ad3514c718a709b8443ab1962
Boot ID: 018da92531e14fdbb73d1bcad59731a3
Virtualization: microsoft
Operating System: Red Hat Enterprise Linux Server 7.5 (Maipo)
CPE OS Name: cpe:/o:redhat:enterprise_linux:7.5:GA:server
Kernel: Linux 3.10.0-862.2.3.el7.x86_64
Architecture: x86-64
</code></pre></li><li><p>docker version</p><pre><code class=language-log>Client:
Version:         1.13.1
API version:     1.26
Package version: docker-1.13.1-63.git94f4240.el7.x86_64
Go version:      go1.9.2
Git commit:      94f4240/1.13.1
Built:           Mon Apr 30 15:45:42 2018
OS/Arch:         linux/amd64

Server:
Version:         1.13.1
API version:     1.26 (minimum version 1.12)
Package version: docker-1.13.1-63.git94f4240.el7.x86_64
Go version:      go1.9.2
Git commit:      94f4240/1.13.1
Built:           Mon Apr 30 15:45:42 2018
OS/Arch:         linux/amd64
Experimental:    false
</code></pre></li></ol><h2 id=錯誤訊息>錯誤訊息</h2><ol><li><p>訊息內容</p><pre><code class=language-log>error parsing HTTP 405 response body: invalid character '&lt;' looking for beginning of value: &quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 3.2 Final//EN\&quot;&gt;\n&lt;title&gt;405 Method Not Allowed&lt;/title&gt;\n&lt;h1&gt;Method Not Allowed&lt;/h1&gt;\n&lt;p&gt;The method POST is not allowed for the requested URL.&lt;/p&gt;\n&quot;
</code></pre></li><li><p>錯誤截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/41497900-ff92a58a-7191-11e8-91a6-92efa6d3fd1a.png alt=1error></p></li></ol><h2 id=問題發生原因>問題發生原因</h2><pre><code class=language-log>- the original BZ wanted the ability to __docker search__ the RH registry for images (nothing to do with push/pull) 
- the original BZ resolution added the rhel registry as the default one, making pushing images just go to the RH registry (which is plain wrong to me, both in RHEL and Fedora)
</code></pre><blockquote><p>原始計畫想要可以使用 <code>docker search</code> 指令來搜尋在 redhat registry 上的 image (只搜尋沒有 <code>pull</code> 及 <code>push</code> 的需求 )，後來決定將 redhat registry 設為預設 registry，也就造成 image push 至 redhat registry 中</p></blockquote><h2 id=解決方式>解決方式</h2><blockquote><p>官方 Bugzilla 顯示問題在 <code>docker-1.13.1-6.git5be1549.fc26</code> 已被解決，只是我個人仍遇到問題，以下提供個人測試可用解決方式</p></blockquote><ol><li><p>開啟 <code>/etc/containers/registries.conf</code></p><pre><code class=language-bash>nano /etc/containers/registries.conf
</code></pre></li><li><p>在 <code>registries</code> 中加入 <code>docker.io</code> 並排在第一順位</p><ul><li><p>原設定</p><pre><code class=language-config>[registries.search]
registries = ['registry.access.redhat.com']
</code></pre></li><li><p>新設定</p><pre><code class=language-config>[registries.search]
registries = ['docker.io','registry.access.redhat.com']
</code></pre></li></ul><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/41497901-ffc0889c-7191-11e8-9284-f64fe926eb62.png alt=2setting></p></blockquote></li><li><p>重新啟動 Docker</p><pre><code class=language-bash>systemctl restart docker
</code></pre></li><li><p>Docker push 成功</p><p><img src=https://user-images.githubusercontent.com/3851540/41497902-ffea2fda-7191-11e8-8479-49fa4b2416c6.png alt=3success></p></li></ol><h2 id=心得>心得</h2><p>原以為輕鬆寫意的動作，竟然連撞兩次牆，看來 Kubernetes 之路不好走呀</p><p>不過據 Red Hat Bugzilla 的資料 <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1434897" target=_blank>Bug 1434897 - docker tries to push to registry.redhat.comr</a> 看來，官方已判定為 bug 並完成修正，待版本更新後問題應該就不會再發生了，但在那之前筆記一下可以節省重建環境時遇到相同狀況都要重新查語法的時間，把時間留給 Kubernetes 的核心功能比較實在呀 @@&rdquo;</p><h2 id=參考資訊>參考資訊</h2><ol><li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1434897" target=_blank>Bug 1434897 - docker tries to push to registry.redhat.comr</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Yowko Tsai</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-11-03</span></p><p class=copyright-item><span class=item-title>授權合約</span>
<span class=item-content>本部落格 (<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a>) 所有的文章內容(包含圖片)，任何轉載行為，必須通知並獲本部落格作者 (<a href=mailto:yowko@yowko.com>Yowko Tsai</a>) 的同意始得轉載,且轉載皆須註明出處與作者。<br><br><div class=separator style=clear:both;text-align:center><a href=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 src=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png></a></div><br>&nbsp;<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a> 由 <a href=https://www.facebook.com/yowko.tsai target=_blank>Yowko Tsai</a> 製作，以<a href=//creativecommons.org/licenses/by-nc-sa/3.0/tw/ target=_blank>創用CC 姓名標示-非商業性-相同方式分享 3.0 台灣 授權條款</a>&nbsp;釋出。</span></p></div><footer class=post-footer><div class=post-tags>標籤：
<a href=https://blog.yowko.com/tags/docker/>Docker</a>
<a href=https://blog.yowko.com/tags/linux/>Linux</a></div><nav class=post-nav><div><a class=prev href=https://blog.yowko.com/windbg-symbol-file-path/ style=float:none><span class="next-text nav-mobile" style=display:inline-block>下一篇</span>
<i class="fas fa-arrow-circle-right"></i><span class="next-text nav-default">WinDbg 設定 symbol file path 的四種方法</span></a></div><div><a class=prev href=https://blog.yowko.com/docker-build-pip-install-fail/ style=float:none><span class="prev-text nav-mobile" style=display:inline-block>上一篇</span>
<i class="fas fa-arrow-circle-left"></i><span class="prev-text nav-default">解決 Docker build pip install fail</span></a></div></nav></footer></article></div><script src=https://giscus.app/client.js data-repo=yowko/yowko.github.io data-repo-id data-category=Announcements data-category-id=DIC_kwDOCsJzG84CW4SD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-TW crossorigin=anonymous async></script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yowko@yowko.com class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/yowko/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/yowko class="iconfont icon-github" title=github></a><a href=https://blog.yowko.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 強力驅動</span>
<span class=division>|</span>
<span class=theme-info>主題 -
<a class=theme-link href=https://github.com/huanlin/hugo-theme-even-more>Even More</a></span>
<span class=copyright-year>&copy;
2016 -
2023
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Yowko Tsai</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="https://blog.yowko.com/lib/highlight/highlight.pack.js?v=20171001"></script><script type=text/javascript src=https://blog.yowko.com/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/instantclick/instantclick-3.0.1.min.js data-no-instant></script><script type=text/javascript src="https://blog.yowko.com/dist/even.min.js?v=3.2.0"></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-7PF6W2W48Y','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>