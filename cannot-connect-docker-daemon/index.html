<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>CentOS 7 Docker 無法連線 Docker daemon？！ - Yowko&#39;s Notes</title><meta name=google-site-verification content=DvajWUA2XrtSgjsnGxXQKihwijBDiTFw9g7cxFY-Ivk><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content="Yowko Tsai"><meta name=description content="CentOS 7 Docker 無法連線 Docker daemon？ 同事想在 VirtualBox 上建立 CentOS 7 虛擬環境，並在 VM 中使用 Docker，在安裝 Docker 時一如往常相當順利直到實際建立 container 時卻遇到無法連"><meta name=keywords content=yowko,.net,blog><meta name=generator content="Hugo 0.56.3"><meta name=msvalidate.01 content=FA1ADBDB8F0BBBD0F7F4E65CDEBF7898><link rel=canonical href=https://blog.yowko.com/cannot-connect-docker-daemon/><link rel=apple-touch-icon sizes=180x180 href=https://blog.yowko.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yowko.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.yowko.com/favicon-16x16.png><link rel=manifest href=https://blog.yowko.com/manifest.json><link rel=mask-icon href=https://blog.yowko.com/safari-pinned-tab.svg color=#5bbad5><link href="https://blog.yowko.com/dist/even.min.css?v=3.2.0" rel=stylesheet><link href=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><meta property=og:title content="CentOS 7 Docker 無法連線 Docker daemon？！"><meta property=og:description content="CentOS 7 Docker 無法連線 Docker daemon？ 同事想在 VirtualBox 上建立 CentOS 7 虛擬環境，並在 VM 中使用 Docker，在安裝 Docker 時一如往常相當順利直到實際建立 container 時卻遇到無法連"><meta property=og:type content=article><meta property=og:url content=https://blog.yowko.com/cannot-connect-docker-daemon/><meta property=article:published_time content=2018-06-06T04:00:00+08:00><meta property=article:modified_time content=2021-11-03T10:43:18+08:00><meta itemprop=name content="CentOS 7 Docker 無法連線 Docker daemon？！"><meta itemprop=description content="CentOS 7 Docker 無法連線 Docker daemon？ 同事想在 VirtualBox 上建立 CentOS 7 虛擬環境，並在 VM 中使用 Docker，在安裝 Docker 時一如往常相當順利直到實際建立 container 時卻遇到無法連"><meta itemprop=datePublished content=2018-06-06T04:00:00&#43;08:00><meta itemprop=dateModified content=2021-11-03T10:43:18&#43;08:00><meta itemprop=wordCount content=914><meta itemprop=keywords content=Docker,Linux,VirtualBox,><meta name=twitter:card content=summary><meta name=twitter:title content="CentOS 7 Docker 無法連線 Docker daemon？！"><meta name=twitter:description content="CentOS 7 Docker 無法連線 Docker daemon？ 同事想在 VirtualBox 上建立 CentOS 7 虛擬環境，並在 VM 中使用 Docker，在安裝 Docker 時一如往常相當順利直到實際建立 container 時卻遇到無法連"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><link href=https://blog.yowko.com/opensearch.xml rel=search title="Content search" type=application/opensearchdescription+xml></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=https://blog.yowko.com/><li class=mobile-menu-item>首頁</li></a><a href=https://blog.yowko.com/post/><li class=mobile-menu-item>歷史筆記</li></a><a href=https://blog.yowko.com/tags/><li class=mobile-menu-item>內容標籤</li></a><a href=https://blog.yowko.com/search><li class=mobile-menu-item>站內搜尋</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header style=height:118px;padding-bottom:0><div class=logo-wrapper><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div style=padding-bottom:60px></div></nav><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/>首頁</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/post/>歷史筆記</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/tags/>內容標籤</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/search>站內搜尋</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><hr style="border-top:1px solid #e6e6e6;border-bottom:0;padding:0"><div id=content class=content><article class=post><header class=post-header><div class=post-meta><span class=post-time>2018-06-06</span>
<span class=more-meta>約 914 字</span>
<span class=more-meta>預計閱讀 2 分鐘</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目錄</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#centos-7-docker-無法連線-docker-daemon>CentOS 7 Docker 無法連線 Docker daemon？</a></li><li><a href=#錯誤訊息>錯誤訊息</a></li><li><a href=#嘗試重新啟動-docker>嘗試重新啟動 Docker</a></li><li><a href=#詳細錯誤>詳細錯誤</a></li><li><a href=#問題發生原因>問題發生原因</a></li><li><a href=#解決方式-擇一即可>解決方式(擇一即可)</a></li><li><a href=#心得>心得</a></li><li><a href=#參考資訊>參考資訊</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=centos-7-docker-無法連線-docker-daemon>CentOS 7 Docker 無法連線 Docker daemon？</h2><p>同事想在 VirtualBox 上建立 CentOS 7 虛擬環境，並在 VM 中使用 Docker，在安裝 Docker 時一如往常相當順利直到實際建立 container 時卻遇到無法連線：<code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock</code> 的提示訊息，重啟 Docker service 時也失敗並得到新的錯誤：<code>Job for docker.service failed because the control process exited with error code.</code></p><p>解決這個問題的過程中學到以前不知道的內容與設定，順手紀錄一下備忘</p><h2 id=錯誤訊息>錯誤訊息</h2><ol><li><p>訊息內容</p><pre><code class=language-log>[root@localhost ~]# docker version                                                 
Client:               
Version:         1.13.1                                         
API version:     1.26                         
Package version:                           
Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
</code></pre></li><li><p>錯誤截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/41012347-b7624782-6973-11e8-8a74-cced8daa1b14.png alt=1error></p></li></ol><h2 id=嘗試重新啟動-docker>嘗試重新啟動 Docker</h2><ol><li><p>重新啟動指令</p><pre><code class=language-bash>sudo systemctl restart docker
</code></pre></li><li><p>重啟失敗</p><ul><li><p>失敗訊息</p><pre><code class=language-log>Job for docker.service failed because the control process exited with error code. See &quot;systemctl status docker.service&quot; and &quot;journalctl -xe&quot; for details
</code></pre></li><li><p>失敗截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/41012348-b78c721e-6973-11e8-828a-704324b785ba.png alt=2restartfail></p></li></ul></li></ol><h2 id=詳細錯誤>詳細錯誤</h2><ol><li><p><code>systemctl status docker.service</code></p><ul><li><p>訊息內容</p><pre><code class=language-log>● docker.service - Docker Application Container Engine
Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
Active: failed (Result: exit-code) since Wed 2018-06-06 01:00:01 CST; 21min ago
    Docs: http://docs.docker.com
Process: 3508 ExecStart=/usr/bin/dockerd-current --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current --default-runtime=docker-runc --exec-opt native.cgroupdriver=systemd --userland-proxy-path=/usr/libexec/docker/docker-proxy-current --init-path=/usr/libexec/docker/docker-init-current --seccomp-profile=/etc/docker/seccomp.json $OPTIONS $DOCKER_STORAGE_OPTIONS $DOCKER_NETWORK_OPTIONS $ADD_REGISTRY $BLOCK_REGISTRY $INSECURE_REGISTRY $REGISTRIES (code=exited, status=1/FAILURE)
Main PID: 3508 (code=exited, status=1/FAILURE)

Jun 06 01:00:00 localhost.localdomain systemd[1]: Starting Docker Application Container Engine...
Jun 06 01:00:00 localhost.localdomain dockerd-current[3508]: time=&quot;2018-06-06T01:00:00.466231528+08:00&quot; level=info msg=&quot;libcontainerd: new contai...: 3515&quot;
Jun 06 01:00:01 localhost.localdomain dockerd-current[3508]: Error starting daemon: SELinux is not supported with the overlay2 graph driver on th...=false)
Jun 06 01:00:01 localhost.localdomain systemd[1]: docker.service: main process exited, code=exited, status=1/FAILURE
Jun 06 01:00:01 localhost.localdomain systemd[1]: Failed to start Docker Application Container Engine.
Jun 06 01:00:01 localhost.localdomain systemd[1]: Unit docker.service entered failed state.
Jun 06 01:00:01 localhost.localdomain systemd[1]: docker.service failed.
Hint: Some lines were ellipsized, use -l to show in full.
</code></pre></li><li><p>訊息截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/41012349-b7b72aa4-6973-11e8-9c4e-3cbef5508328.png alt=3servicestatus></p></li></ul></li><li><p><code>journalctl -xe</code></p><blockquote><p>錯誤內容非常多，就不另外貼出來了</p></blockquote><p><img src=https://user-images.githubusercontent.com/3851540/41012350-b7e1ffd6-6973-11e8-9444-03f50a5b19a0.png alt=4jx></p></li></ol><h2 id=問題發生原因>問題發生原因</h2><p>透過檢視 <code>journalctl -xe</code> 的錯誤資訊，可以發現重要線索：<code>linux kernel 中的 SELinux 不支援 overlay2 graph driver</code></p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/41012351-b80bb196-6973-11e8-945e-a8dd14516d8b.png alt=5rootcause></p></blockquote><h2 id=解決方式-擇一即可>解決方式(擇一即可)</h2><ol><li><p>自行啟動 Docker</p><ul><li><p>一個 process (一個 linux 連線) 執行下列指令</p><ul><li><code>nohup</code> 登出不中斷執行</li><li>Docker 預設是透過 <code>unix:///var/run/docker.sock</code> 執行</li><li><p>可以透過 <code>-H</code> 加上 tcp 即可允許 curl 連線操作</p><blockquote><p><code>nohup docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</code></p></blockquote><pre><code class=language-bash>nohup docker daemon -H unix:///var/run/docker.sock
</code></pre></li></ul></li><li><p>另一個 proccess (另一個 linux 連線) 就可以正常使用 docker 指令</p></li></ul></li><li><p>修改 Docker service 啟動指令</p><ul><li>開啟 <code>/usr/lib/systemd/system/docker.service</code></li><li><p>修改 <code>ExecStart</code></p><pre><code class=language-bash>ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock
</code></pre></li><li><p>重新讀取設定</p><pre><code class=language-bash>systemctl daemon-reload
</code></pre></li><li><p>重啟 Docker service</p><pre><code class=language-bash>systemctl restart docker.service
</code></pre></li></ul></li><li><p>停用 Docker 的 selinux</p><ul><li>開啟 <code>vi /etc/sysconfig/docker</code></li><li><p>將 <code>--selinux-enabled</code> 改為 <code>--selinux-enabled=false</code></p><p><img src=https://user-images.githubusercontent.com/3851540/41012345-b70bba66-6973-11e8-931f-e74bd6523a8d.png alt=6selinux></p><p><img src=https://user-images.githubusercontent.com/3851540/41012346-b7385b0c-6973-11e8-90b5-53ee1aea6f64.png alt=7selinux></p></li><li><p>啟動 Docker service</p><pre><code class=language-bash>systemctl start docker.service
</code></pre></li></ul></li></ol><h2 id=心得>心得</h2><p>雖然還沒確定問題發生原因前就猜測是設定造成的，但透過 <code>setenforce 0</code> 暫時關閉 SElinux 後仍無法正常使用，原以為已可排除 SElinux 設定問題，想不到只是自己才疏學淺呀。</p><p>經過同事這次遇到的狀況，才得以多瞭解到原來 Docker service 預設是使用 <code>unix:///var/run/docker.sock</code> 進行服務，不僅可以手動建立 Docker daemon 還可以透過 tcp 綁定啟用 Docker Remote API</p><p>近幾個月 Kubenetes 的網路聲量很大，相較之下 Docker 近期發展上比較少大型爆發性變動，正面思考是相關 API 已經穩定可以符合多數情境了，只是就我自己的使用經驗還有太多東西不知道，常常遇到問題要花不少時間才能解決，這樣跨入 Kubenetes 難免多了一些不安定因素，但 Kubenetes 的學習不能等待呀 哈哈</p><h2 id=參考資訊>參考資訊</h2><ol><li><a href=https://stackoverflow.com/questions/44678725/cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker target=_blank>Cannot connect to the Docker daemon at unix:/var/run/docker.sock. Is the docker daemon running?</a></li><li><a href=https://www.zhihu.com/question/24852884 target=_blank>Docker Remote API 如何使用？</a></li><li><a href=https://blog.csdn.net/a1010256340/article/details/80106156 target=_blank>ocker啟動報錯：Error starting daemon: SELinux is not supported with the overlay2 graph driver on this ke</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Yowko Tsai</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-11-03</span></p><p class=copyright-item><span class=item-title>授權合約</span>
<span class=item-content>本部落格 (<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a>) 所有的文章內容(包含圖片)，任何轉載行為，必須通知並獲本部落格作者 (<a href=mailto:yowko@yowko.com>Yowko Tsai</a>) 的同意始得轉載,且轉載皆須註明出處與作者。<br><br><div class=separator style=clear:both;text-align:center><a href=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 src=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png></a></div><br>&nbsp;<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a> 由 <a href=https://www.facebook.com/yowko.tsai target=_blank>Yowko Tsai</a> 製作，以<a href=//creativecommons.org/licenses/by-nc-sa/3.0/tw/ target=_blank>創用CC 姓名標示-非商業性-相同方式分享 3.0 台灣 授權條款</a>&nbsp;釋出。</span></p></div><footer class=post-footer><div class=post-tags>標籤：
<a href=https://blog.yowko.com/tags/docker/>Docker</a>
<a href=https://blog.yowko.com/tags/linux/>Linux</a>
<a href=https://blog.yowko.com/tags/virtualbox/>VirtualBox</a></div><nav class=post-nav><div><a class=prev href=https://blog.yowko.com/oracle-maximum-open-cursors-exceeded/ style=float:none><span class="next-text nav-mobile" style=display:inline-block>下一篇</span>
<i class="fas fa-arrow-circle-right"></i><span class="next-text nav-default">C# 連線 Oracle 出現 ORA-01000: maximum open cursors exceeded</span></a></div><div><a class=prev href=https://blog.yowko.com/entityframework-6-concurrency-oracle/ style=float:none><span class="prev-text nav-mobile" style=display:inline-block>上一篇</span>
<i class="fas fa-arrow-circle-left"></i><span class="prev-text nav-default">如何避免多個 EntityFramework 6 instance 造成資料覆蓋問題 (DB First - Oracle)</span></a></div></nav></footer></article></div><script src=https://giscus.app/client.js data-repo=yowko/yowko.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxODA1MTU2MTE=" data-category=Announcements data-category-id=DIC_kwDOCsJzG84CW4SD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-TW crossorigin=anonymous async></script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yowko@yowko.com class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/yowko/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/yowko class="iconfont icon-github" title=github></a><a href=https://blog.yowko.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 強力驅動</span>
<span class=division>|</span>
<span class=theme-info>主題 -
<a class=theme-link href=https://github.com/huanlin/hugo-theme-even-more>Even More</a></span>
<span class=copyright-year>&copy;
2016 -
2025
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Yowko Tsai</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="https://blog.yowko.com/lib/highlight/highlight.pack.js?v=20171001"></script><script type=text/javascript src=https://blog.yowko.com/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/instantclick/instantclick-3.0.1.min.js data-no-instant></script><script type=text/javascript src="https://blog.yowko.com/dist/even.min.js?v=3.2.0"></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-7PF6W2W48Y','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>