<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>ASP.NET MVC 送出含有 `&lt;` 的表單內容時出現錯誤 - Yowko&#39;s Notes</title><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content="Yowko Tsai"><meta name=description content="ASP.NET MVC 送出含有 &amp;lt; 的表單內容時出現錯誤 這是同事今天遇到的問題，當看到錯誤訊息時，我心中百感交集，想當年沒日沒夜趕專案時，這個錯誤訊息可是三天兩頭"><meta name=keywords content=yowko,.net,blog><meta name=generator content="Hugo 0.56.3"><meta name=msvalidate.01 content=FA1ADBDB8F0BBBD0F7F4E65CDEBF7898><link rel=canonical href=https://blog.yowko.com/aspnet-mvc-post-html/><link rel=apple-touch-icon sizes=180x180 href=https://blog.yowko.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yowko.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.yowko.com/favicon-16x16.png><link rel=manifest href=https://blog.yowko.com/manifest.json><link rel=mask-icon href=https://blog.yowko.com/safari-pinned-tab.svg color=#5bbad5><link href="https://blog.yowko.com/dist/even.min.css?v=3.2.0" rel=stylesheet><link href=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><meta property=og:title content="ASP.NET MVC 送出含有 `&lt;` 的表單內容時出現錯誤"><meta property=og:description content="ASP.NET MVC 送出含有 &lt; 的表單內容時出現錯誤 這是同事今天遇到的問題，當看到錯誤訊息時，我心中百感交集，想當年沒日沒夜趕專案時，這個錯誤訊息可是三天兩頭"><meta property=og:type content=article><meta property=og:url content=https://blog.yowko.com/aspnet-mvc-post-html/><meta property=article:published_time content=2017-06-17T00:42:00+08:00><meta property=article:modified_time content=2021-11-03T00:42:09+08:00><meta itemprop=name content="ASP.NET MVC 送出含有 `&lt;` 的表單內容時出現錯誤"><meta itemprop=description content="ASP.NET MVC 送出含有 &lt; 的表單內容時出現錯誤 這是同事今天遇到的問題，當看到錯誤訊息時，我心中百感交集，想當年沒日沒夜趕專案時，這個錯誤訊息可是三天兩頭"><meta itemprop=datePublished content=2017-06-17T00:42:00&#43;08:00><meta itemprop=dateModified content=2021-11-03T00:42:09&#43;08:00><meta itemprop=wordCount content=771><meta itemprop=keywords content="ASP.NET MVC,ASP.NET Web API,"><meta name=twitter:card content=summary><meta name=twitter:title content="ASP.NET MVC 送出含有 `&lt;` 的表單內容時出現錯誤"><meta name=twitter:description content="ASP.NET MVC 送出含有 &lt; 的表單內容時出現錯誤 這是同事今天遇到的問題，當看到錯誤訊息時，我心中百感交集，想當年沒日沒夜趕專案時，這個錯誤訊息可是三天兩頭"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><link href=https://blog.yowko.com/opensearch.xml rel=search title="Content search" type=application/opensearchdescription+xml></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=https://blog.yowko.com/><li class=mobile-menu-item>首頁</li></a><a href=https://blog.yowko.com/post/><li class=mobile-menu-item>歷史筆記</li></a><a href=https://blog.yowko.com/tags/><li class=mobile-menu-item>內容標籤</li></a><a href=https://blog.yowko.com/search><li class=mobile-menu-item>站內搜尋</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header style=height:118px;padding-bottom:0><div class=logo-wrapper><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div style=padding-bottom:60px></div></nav><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/>首頁</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/post/>歷史筆記</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/tags/>內容標籤</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/search>站內搜尋</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><hr style="border-top:1px solid #e6e6e6;border-bottom:0;padding:0"><div id=content class=content><article class=post><header class=post-header><div class=post-meta><span class=post-time>2017-06-17</span>
<span class=more-meta>約 771 字</span>
<span class=more-meta>預計閱讀 2 分鐘</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目錄</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#asp-net-mvc-送出含有-的表單內容時出現錯誤>ASP.NET MVC 送出含有 <code>&lt;</code> 的表單內容時出現錯誤</a></li><li><a href=#錯誤訊息>錯誤訊息</a></li><li><a href=#原始程式碼>原始程式碼</a></li><li><a href=#如何調整>如何調整</a></li><li><a href=#如何優化>如何優化</a></li><li><a href=#心得>心得</a></li><li><a href=#參考資訊>參考資訊</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=asp-net-mvc-送出含有-的表單內容時出現錯誤>ASP.NET MVC 送出含有 <code>&lt;</code> 的表單內容時出現錯誤</h2><p>這是同事今天遇到的問題，當看到錯誤訊息時，我心中百感交集，想當年沒日沒夜趕專案時，這個錯誤訊息可是三天兩頭就會看到一次：基本的 CMS 後台常常搭配的就是 HTML 編輯器，MVC 一送出就會出現一樣熟悉的錯誤訊息。</p><p>雖然是錯誤訊息，但像是久未謀面的老朋友，再次相見也時隔二三年了，心中竟有些懷念，也許懷念的不是一樣的錯誤訊息而是懷念當年錯誤訊息代表的時空背景；除了懷念，也充滿了感嘆，當年看到這個錯誤訊息，腦袋都還沒完全反應過來，手已經敲著鍵盤把問題解決了XD 時隔三年的今日，我竟連關鍵字都想不起來，可真是歲月不饒人呀，為了避免下次又想不起來 只得認份地筆記一下</p><h2 id=錯誤訊息>錯誤訊息</h2><ol><li><p>錯誤訊息</p><pre><code class=language-log>Server Error in '/' Application.

A potentially dangerous Request.Form value was detected from the client (value=&quot;&lt;dsfsd132&quot;).

Description: ASP.NET has detected data in the request that is potentially dangerous because it might include HTML markup or script. The data might represent an attempt to compromise the security of your application, such as a cross-site scripting attack. If this type of input is appropriate in your application, you can include code in a web page to explicitly allow it. For more information, see http://go.microsoft.com/fwlink/?LinkID=212874. 

Exception Details: System.Web.HttpRequestValidationException: A potentially dangerous Request.Form value was detected from the client (value=&quot;&lt;dsfsd132&quot;).

Source Error:
</code></pre></li><li><p>錯誤截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/27235954-88eab5b4-52f5-11e7-977b-6eabaf562d70.png alt=1errormsg></p></li></ol><blockquote><p>大意就是偵測到 user 輸入的資料中出現了 html 語法或是 javascript，為了避免 XSS 攻擊，所以拒絕網頁執行</p></blockquote><h2 id=原始程式碼>原始程式碼</h2><ol><li><p>MVC 的 controller</p><pre><code class=language-cs>public ActionResult Values(string value, int id)
{
    return Content($&quot;{id}-{value}&quot;);
}
</code></pre></li><li><p>網頁</p><pre><code class=language-cs>@using (Html.BeginForm(&quot;values&quot;, &quot;Home&quot;, FormMethod.Post))
{
    @Html.TextBox(&quot;id&quot;,11);
    @Html.TextBox(&quot;value&quot;);
    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;btn btn-primary&quot;/&gt;
}
</code></pre></li></ol><h2 id=如何調整>如何調整</h2><ul><li><p>指定 Action 不檢查</p><blockquote><p>在 Action 上套用 <code>[ValidateInput(false)]</code></p></blockquote><pre><code class=language-cs>[ValidateInput(false)]
public ActionResult Values(string value, int id)
{
    return Content($&quot;{id}-{value}&quot;);
}
</code></pre></li></ul><h2 id=如何優化>如何優化</h2><p>直接在 action 上套用 <code>[ValidateInput(false)]</code> 是快速又有效的，只是套用 <code>[ValidateInput(false)]</code> 後會讓整個 Action 都不做 XSS 的 HTML tag 檢查，這樣是有風險的，正確的做法：<span style=color:red>僅針對需要的欄位屬性開放</span>，不該是無差別式地全部開放</p><ul><li><p>修改方式</p><ul><li><p>將所有傳遞參數統整為一個 class</p><pre><code class=language-cs>public ActionResult Values(string value, int id)
</code></pre></li><li><p>改為下列寫法</p><pre><code class=language-cs>public ActionResult Values(PstData model)
public class PstData
{
    public int id { get; set; }
    public string value { get; set; }
}
</code></pre></li><li><p>在需要開放的屬性上套件 <code>[AllowHtml]</code></p><pre><code class=language-cs>public class PstData
{
    public int id { get; set; }
    [AllowHtml]
    public string value { get; set; }
}
</code></pre></li></ul></li></ul><h2 id=心得>心得</h2><p>順手測試了 ASP.NET Web Api，並沒有相同檢查，個人推測 Web API 沒有頁面，不會發生 XSS 的問題，就是資料存取的角色，所以沒有特別檢查</p><p>雖然是個曾經熟悉現在又顯得陌生的問題，但重新複習起來也別有一番風味呀</p><h2 id=參考資訊>參考資訊</h2><ol><li><a href=https://msdn.microsoft.com/en-us/library/hh882339.aspx target=_blank>Request Validation in ASP.NET</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Yowko Tsai</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-11-03</span></p><p class=copyright-item><span class=item-title>授權合約</span>
<span class=item-content>本部落格 (<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a>) 所有的文章內容(包含圖片)，任何轉載行為，必須通知並獲本部落格作者 (<a href=mailto:yowko@yowko.com>Yowko Tsai</a>) 的同意始得轉載,且轉載皆須註明出處與作者。<br><br><div class=separator style=clear:both;text-align:center><a href=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 src=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png></a></div><br>&nbsp;<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a> 由 <a href=https://www.facebook.com/yowko.tsai target=_blank>Yowko Tsai</a> 製作，以<a href=//creativecommons.org/licenses/by-nc-sa/3.0/tw/ target=_blank>創用CC 姓名標示-非商業性-相同方式分享 3.0 台灣 授權條款</a>&nbsp;釋出。</span></p></div><footer class=post-footer><div class=post-tags>標籤：
<a href=https://blog.yowko.com/tags/asp.net-mvc/>ASP.NET MVC</a>
<a href=https://blog.yowko.com/tags/asp.net-web-api/>ASP.NET Web API</a></div><nav class=post-nav><div><a class=prev href=https://blog.yowko.com/unit-test-static-field-property/ style=float:none><span class="next-text nav-mobile" style=display:inline-block>下一篇</span>
<i class="fas fa-arrow-circle-right"></i><span class="next-text nav-default">Unit Test 該拿 static 屬性及欄位怎麼辦？ - 使用 PrivateType</span></a></div><div><a class=prev href=https://blog.yowko.com/unit-test-web-api-ihttpactionresult/ style=float:none><span class="prev-text nav-mobile" style=display:inline-block>上一篇</span>
<i class="fas fa-arrow-circle-left"></i><span class="prev-text nav-default">Unit Test 如何驗證 ASP.NET Web Api 的 IHttpActionResult</span></a></div></nav></footer></article></div><script src=https://giscus.app/client.js data-repo=yowko/yowko.github.io data-repo-id data-category=Announcements data-category-id=DIC_kwDOCsJzG84CW4SD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-TW crossorigin=anonymous async></script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yowko@yowko.com class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/yowko/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/yowko class="iconfont icon-github" title=github></a><a href=https://blog.yowko.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 強力驅動</span>
<span class=division>|</span>
<span class=theme-info>主題 -
<a class=theme-link href=https://github.com/huanlin/hugo-theme-even-more>Even More</a></span>
<span class=copyright-year>&copy;
2016 -
2023
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Yowko Tsai</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="https://blog.yowko.com/lib/highlight/highlight.pack.js?v=20171001"></script><script type=text/javascript src=https://blog.yowko.com/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/instantclick/instantclick-3.0.1.min.js data-no-instant></script><script data-no-instant>InstantClick.init();</script><script type=text/javascript src="https://blog.yowko.com/dist/even.min.js?v=3.2.0"></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-7PF6W2W48Y','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>