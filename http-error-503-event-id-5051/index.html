<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>IIS 出現 Service Unavailable HTTP Error 503 - Windows Process Activation Service (WAS) Error - Yowko&#39;s Notes</title><meta name=google-site-verification content=DvajWUA2XrtSgjsnGxXQKihwijBDiTFw9g7cxFY-Ivk><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content="Yowko Tsai"><meta name=description content=這個問題遇到第二次了，照以往的習慣：問題遇到二次以上就要來筆記一下，避免下次再遇到又要花好多時間追查。之前沒有紀錄的原因：一來是覺得狀況特殊><meta name=keywords content=yowko,.net,blog><meta name=generator content="Hugo 0.56.3"><meta name=msvalidate.01 content=FA1ADBDB8F0BBBD0F7F4E65CDEBF7898><link rel=canonical href=https://blog.yowko.com/http-error-503-event-id-5051/><link rel=apple-touch-icon sizes=180x180 href=https://blog.yowko.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yowko.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.yowko.com/favicon-16x16.png><link rel=manifest href=https://blog.yowko.com/manifest.json><link rel=mask-icon href=https://blog.yowko.com/safari-pinned-tab.svg color=#5bbad5><link href="https://blog.yowko.com/dist/even.min.css?v=3.2.0" rel=stylesheet><link href=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><meta property=og:title content="IIS 出現 Service Unavailable HTTP Error 503 - Windows Process Activation Service (WAS) Error"><meta property=og:description content=這個問題遇到第二次了，照以往的習慣：問題遇到二次以上就要來筆記一下，避免下次再遇到又要花好多時間追查。之前沒有紀錄的原因：一來是覺得狀況特殊><meta property=og:type content=article><meta property=og:url content=https://blog.yowko.com/http-error-503-event-id-5051/><meta property=article:published_time content=2018-04-23T22:30:00+08:00><meta property=article:modified_time content=2021-11-02T10:18:55+08:00><meta itemprop=name content="IIS 出現 Service Unavailable HTTP Error 503 - Windows Process Activation Service (WAS) Error"><meta itemprop=description content=這個問題遇到第二次了，照以往的習慣：問題遇到二次以上就要來筆記一下，避免下次再遇到又要花好多時間追查。之前沒有紀錄的原因：一來是覺得狀況特殊><meta itemprop=datePublished content=2018-04-23T22:30:00&#43;08:00><meta itemprop=dateModified content=2021-11-02T10:18:55&#43;08:00><meta itemprop=wordCount content=831><meta itemprop=keywords content=IIS,><meta name=twitter:card content=summary><meta name=twitter:title content="IIS 出現 Service Unavailable HTTP Error 503 - Windows Process Activation Service (WAS) Error"><meta name=twitter:description content=這個問題遇到第二次了，照以往的習慣：問題遇到二次以上就要來筆記一下，避免下次再遇到又要花好多時間追查。之前沒有紀錄的原因：一來是覺得狀況特殊><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><link href=https://blog.yowko.com/opensearch.xml rel=search title="Content search" type=application/opensearchdescription+xml></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=https://blog.yowko.com/><li class=mobile-menu-item>首頁</li></a><a href=https://blog.yowko.com/post/><li class=mobile-menu-item>歷史筆記</li></a><a href=https://blog.yowko.com/tags/><li class=mobile-menu-item>內容標籤</li></a><a href=https://blog.yowko.com/search><li class=mobile-menu-item>站內搜尋</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header style=height:118px;padding-bottom:0><div class=logo-wrapper><a href=https://blog.yowko.com/ class=logo>Yowko&#39;s Notes</a></div><div style=padding-bottom:60px></div></nav><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/>首頁</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/post/>歷史筆記</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/tags/>內容標籤</a></li><li class=menu-item><a class=menu-item-link href=https://blog.yowko.com/search>站內搜尋</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><hr style="border-top:1px solid #e6e6e6;border-bottom:0;padding:0"><div id=content class=content><article class=post><header class=post-header><div class=post-meta><span class=post-time>2018-04-23</span>
<span class=more-meta>約 831 字</span>
<span class=more-meta>預計閱讀 2 分鐘</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目錄</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#錯誤訊息>錯誤訊息</a></li><li><a href=#解決方式>解決方式</a></li><li><a href=#如何確認解決方式適用>如何確認解決方式適用</a></li><li><a href=#需要-logon-as-batch-job-權限的情境>需要 Logon as Batch Job 權限的情境</a></li><li><a href=#心得>心得</a></li><li><a href=#參考資訊>參考資訊</a></li></ul></li></ul></nav></div></div><div class=post-content><p>這個問題遇到第二次了，照以往的習慣：問題遇到二次以上就要來筆記一下，避免下次再遇到又要花好多時間追查。之前沒有紀錄的原因：一來是覺得狀況特殊不太有機會再遇到，二來就是牽涉到的功能及設定不好模擬，但這次遇到相同問題又讓我花了好幾個小時才確認問題，所以多花點時間準備環境來完成紀錄</p><p>這次遇到的問題，外顯的錯誤訊息很籠統，第一時間並不好定位出問題，但搭配 event log 難度就會降低許多，就來看看實際的狀況為何吧</p><h2 id=錯誤訊息>錯誤訊息</h2><ol><li><p>訊息內容</p><pre><code class=language-text>Service Unavailable
HTTP Error 503. The service is unavailable.
</code></pre></li><li><p>錯誤截圖</p><p><img src=https://user-images.githubusercontent.com/3851540/39143392-620734f8-4760-11e8-9b56-e0aaa5939e0c.png alt=1error></p></li></ol><h2 id=解決方式>解決方式</h2><blockquote><p>請務必確認遇到的狀況與下方 <code>如何確認解決方式適用</code> 情境相符</p></blockquote><ol><li><p>取得 IIS Application Pool 所使用的 Identity</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143393-622f7968-4760-11e8-8fd4-d8d4f41fa835.png alt=2identity></p></blockquote></li><li><p>開啟 Local Policies &ndash;&gt; User Rights Assignment &ndash;&gt; Log on as a batch job</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143394-62578bc4-4760-11e8-987c-09f46ae52aaf.png alt=3logonasbatch></p></blockquote></li><li><p>Add User or Group&hellip;</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143395-62812ae2-4760-11e8-9b1d-8fd3cecec471.png alt=4adduser></p></blockquote></li><li><p>重新開機(不一定需要)</p><blockquote><p>較新的 Windows 10 及 Windows Server 2016 都可以直接生效，如果較舊的作業系統建議重新開機</p></blockquote></li></ol><h2 id=如何確認解決方式適用>如何確認解決方式適用</h2><ol><li><p>IIS 出現 503 Service Unavailable</p></li><li><p>Application Pool 啟動後立即被停止</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143396-62aede7e-4760-11e8-92d0-6d3992cc6719.png alt=5alwaysstop></p></blockquote></li><li><p>Event log 中出現 WAS 類型的 Error 及 Warning</p><blockquote><p>以下三個 WAS 類型的 Error 及 Warning 會接續出現</p></blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143397-62dbd460-4760-11e8-9d2c-e53314ea1ec9.png alt=6eventlog></p><ul><li><p><code>Error</code> - Event ID 5059</p><pre><code class=language-text>Application pool TestTimeout has been disabled. Windows Process Activation Service (WAS) encountered a failure when it started a worker process to serve the application pool.
</code></pre><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143398-6309cdfc-4760-11e8-84e0-91407e871335.png alt=7eventerror></p></blockquote></li><li><p><code>Warning</code> - Event ID 5057</p><pre><code class=language-text>Application pool TestTimeout has been disabled. Windows Process Activation Service (WAS) did not create a worker process to serve the application pool because the application pool identity is invalid.
</code></pre><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143399-63353a5a-4760-11e8-8ce4-a1a3f9f87097.png alt=8eventwarning1></p></blockquote></li><li><p><code>Warning</code> - Event ID 5051</p><pre><code class=language-text>The identity of application pool TestTimeout is invalid. The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights. If the identity is not corrected, the application pool will be disabled when the application pool receives its first request.  If batch logon rights are causing the problem, the identity in the IIS configuration store must be changed after rights have been granted before Windows Process Activation Service (WAS) can retry the logon. If the identity remains invalid after the first request for the application pool is processed, the application pool will be disabled. The data field contains the error number.
</code></pre><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143401-636fe178-4760-11e8-8c80-486262dded71.png alt=9eventwarning2></p></blockquote></li></ul></li></ol><h2 id=需要-logon-as-batch-job-權限的情境>需要 Logon as Batch Job 權限的情境</h2><ol><li><p>寫入資料至分享資料夾</p><blockquote><p>我遇到的狀況屬於這個</p></blockquote><ul><li><p>程式使用到分享資料夾(透過網路位置加入)</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143402-639c81f6-4760-11e8-86a1-2413b5104c40.png alt=10networklocation></p></blockquote></li><li><p>IIS 使用特定 user 來存取網路硬碟</p><blockquote><p><img src=https://user-images.githubusercontent.com/3851540/39143391-61c353dc-4760-11e8-97f2-e43b22b291dc.png alt=11poolidentity></p></blockquote></li></ul></li><li><p>使用分享印表機</p></li><li><p>執行互動式程式</p></li></ol><h2 id=心得>心得</h2><p>這次遇到的問題以結果來看不算是困難的狀況，但為了確認解決方案花了較多的心力，主要原因在於實際遇到的 Server 我沒有管理權限，AD 設定也看不到，所以要調整 Group Policies 就變得困難，排除這個因素在定位錯誤原因也花了不少時間：雖然 event log 中有提到缺少 batch logon 的權限，但遲遲沒有意識到是個 Local Policies 的設定，所幸透過重新模擬環境得以完成紀錄，不用擔心下次再遇到問題又要花很多時間才能解決了 哈哈</p><h2 id=參考資訊>參考資訊</h2><ol><li><a href=https://www.howtogeek.com/tips/how-to-see-which-group-your-windows-user-belongs-to/ target=_blank>How to See Which Groups Your Windows User Account Belongs To</a></li><li><a href=https://www.brooksnet.com/faq/granting-logon-as-batch-privilege target=_blank>Granting &ldquo;Logon as a batch job&rdquo;</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Yowko Tsai</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-11-02</span></p><p class=copyright-item><span class=item-title>授權合約</span>
<span class=item-content>本部落格 (<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a>) 所有的文章內容(包含圖片)，任何轉載行為，必須通知並獲本部落格作者 (<a href=mailto:yowko@yowko.com>Yowko Tsai</a>) 的同意始得轉載,且轉載皆須註明出處與作者。<br><br><div class=separator style=clear:both;text-align:center><a href=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png imageanchor=1 style=margin-left:1em;margin-right:1em><img border=0 src=//i.creativecommons.org/l/by-nc-sa/3.0/tw/88x31.png></a></div><br>&nbsp;<a href=//blog.yowko.com target=_blank>Yowko&#39;s Notes</a> 由 <a href=https://www.facebook.com/yowko.tsai target=_blank>Yowko Tsai</a> 製作，以<a href=//creativecommons.org/licenses/by-nc-sa/3.0/tw/ target=_blank>創用CC 姓名標示-非商業性-相同方式分享 3.0 台灣 授權條款</a>&nbsp;釋出。</span></p></div><footer class=post-footer><div class=post-tags>標籤：
<a href=https://blog.yowko.com/tags/iis/>IIS</a></div><nav class=post-nav><div><a class=prev href=https://blog.yowko.com/aspnet-mvc-httpantiforgeryexception-redirect/ style=float:none><span class="next-text nav-mobile" style=display:inline-block>下一篇</span>
<i class="fas fa-arrow-circle-right"></i><span class="next-text nav-default">在 ASP.NET MVC 出現 HttpAntiForgeryException 錯誤時 Redirect 至指定 Controller、Action</span></a></div><div><a class=prev href=https://blog.yowko.com/dapper-timeout/ style=float:none><span class="prev-text nav-mobile" style=display:inline-block>上一篇</span>
<i class="fas fa-arrow-circle-left"></i><span class="prev-text nav-default">C# 使用 Dapper 連線 DB 時指定逾時時間 (timeout)：0x80004005</span></a></div></nav></footer></article></div><script src=https://giscus.app/client.js data-repo=yowko/yowko.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxODA1MTU2MTE=" data-category=Announcements data-category-id=DIC_kwDOCsJzG84CW4SD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-TW crossorigin=anonymous async></script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yowko@yowko.com class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/yowko/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/yowko class="iconfont icon-github" title=github></a><a href=https://blog.yowko.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 強力驅動</span>
<span class=division>|</span>
<span class=theme-info>主題 -
<a class=theme-link href=https://github.com/huanlin/hugo-theme-even-more>Even More</a></span>
<span class=copyright-year>&copy;
2016 -
2023
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Yowko Tsai</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="https://blog.yowko.com/lib/highlight/highlight.pack.js?v=20171001"></script><script type=text/javascript src=https://blog.yowko.com/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/fancybox/jquery.fancybox-3.1.20.min.js></script><script type=text/javascript src=https://blog.yowko.com/lib/instantclick/instantclick-3.0.1.min.js data-no-instant></script><script type=text/javascript src="https://blog.yowko.com/dist/even.min.js?v=3.2.0"></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-7PF6W2W48Y','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>